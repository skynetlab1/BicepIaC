{
    "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "environmentName": {
            "minLength": 1,
            "maxLength": 64,
            "type": "String",
            "metadata": {
                "description": "Name of the environment that can be used as part of naming resource convention"
            }
        },
        "location": {
            "minLength": 1,
            "type": "String",
            "metadata": {
                "description": "Primary location for all resources"
            }
        },
        "principalId": {
            "type": "String",
            "metadata": {
                "description": "Id of the user or app to assign application roles"
            }
        }
    },
    "variables": {
        "$fxv#0": {
            "analysisServicesServers": "as",
            "apiManagementService": "apim-",
            "appConfigurationStores": "appcs-",
            "appManagedEnvironments": "cae-",
            "appContainerApps": "ca-",
            "authorizationPolicyDefinitions": "policy-",
            "automationAutomationAccounts": "aa-",
            "blueprintBlueprints": "bp-",
            "blueprintBlueprintsArtifacts": "bpa-",
            "cacheRedis": "redis-",
            "cdnProfiles": "cdnp-",
            "cdnProfilesEndpoints": "cdne-",
            "cognitiveServicesAccounts": "cog-",
            "cognitiveServicesFormRecognizer": "cog-fr-",
            "cognitiveServicesTextAnalytics": "cog-ta-",
            "computeAvailabilitySets": "avail-",
            "computeCloudServices": "cld-",
            "computeDiskEncryptionSets": "des",
            "computeDisks": "disk",
            "computeDisksOs": "osdisk",
            "computeGalleries": "gal",
            "computeSnapshots": "snap-",
            "computeVirtualMachines": "vm",
            "computeVirtualMachineScaleSets": "vmss-",
            "containerInstanceContainerGroups": "ci",
            "containerRegistryRegistries": "cr",
            "containerServiceManagedClusters": "aks-",
            "databricksWorkspaces": "dbw-",
            "dataFactoryFactories": "adf-",
            "dataLakeAnalyticsAccounts": "dla",
            "dataLakeStoreAccounts": "dls",
            "dataMigrationServices": "dms-",
            "dBforMySQLServers": "mysql-",
            "dBforPostgreSQLServers": "psql-",
            "devicesIotHubs": "iot-",
            "devicesProvisioningServices": "provs-",
            "devicesProvisioningServicesCertificates": "pcert-",
            "documentDBDatabaseAccounts": "cosmos-",
            "eventGridDomains": "evgd-",
            "eventGridDomainsTopics": "evgt-",
            "eventGridEventSubscriptions": "evgs-",
            "eventHubNamespaces": "evhns-",
            "eventHubNamespacesEventHubs": "evh-",
            "hdInsightClustersHadoop": "hadoop-",
            "hdInsightClustersHbase": "hbase-",
            "hdInsightClustersKafka": "kafka-",
            "hdInsightClustersMl": "mls-",
            "hdInsightClustersSpark": "spark-",
            "hdInsightClustersStorm": "storm-",
            "hybridComputeMachines": "arcs-",
            "insightsActionGroups": "ag-",
            "insightsComponents": "appi-",
            "keyVaultVaults": "kv-",
            "kubernetesConnectedClusters": "arck",
            "kustoClusters": "dec",
            "kustoClustersDatabases": "dedb",
            "logicIntegrationAccounts": "ia-",
            "logicWorkflows": "logic-",
            "machineLearningServicesWorkspaces": "mlw-",
            "managedIdentityUserAssignedIdentities": "id-",
            "managementManagementGroups": "mg-",
            "migrateAssessmentProjects": "migr-",
            "networkApplicationGateways": "agw-",
            "networkApplicationSecurityGroups": "asg-",
            "networkAzureFirewalls": "afw-",
            "networkBastionHosts": "bas-",
            "networkConnections": "con-",
            "networkDnsZones": "dnsz-",
            "networkExpressRouteCircuits": "erc-",
            "networkFirewallPolicies": "afwp-",
            "networkFirewallPoliciesWebApplication": "waf",
            "networkFirewallPoliciesRuleGroups": "wafrg",
            "networkFrontDoors": "fd-",
            "networkFrontdoorWebApplicationFirewallPolicies": "fdfp-",
            "networkLoadBalancersExternal": "lbe-",
            "networkLoadBalancersInternal": "lbi-",
            "networkLoadBalancersInboundNatRules": "rule-",
            "networkLocalNetworkGateways": "lgw-",
            "networkNatGateways": "ng-",
            "networkNetworkInterfaces": "nic-",
            "networkNetworkSecurityGroups": "nsg-",
            "networkNetworkSecurityGroupsSecurityRules": "nsgsr-",
            "networkNetworkWatchers": "nw-",
            "networkPrivateDnsZones": "pdnsz-",
            "networkPrivateLinkServices": "pl-",
            "networkPublicIPAddresses": "pip-",
            "networkPublicIPPrefixes": "ippre-",
            "networkRouteFilters": "rf-",
            "networkRouteTables": "rt-",
            "networkRouteTablesRoutes": "udr-",
            "networkTrafficManagerProfiles": "traf-",
            "networkVirtualNetworkGateways": "vgw-",
            "networkVirtualNetworks": "vnet-",
            "networkVirtualNetworksSubnets": "snet-",
            "networkVirtualNetworksVirtualNetworkPeerings": "peer-",
            "networkVirtualWans": "vwan-",
            "networkVpnGateways": "vpng-",
            "networkVpnGatewaysVpnConnections": "vcn-",
            "networkVpnGatewaysVpnSites": "vst-",
            "notificationHubsNamespaces": "ntfns-",
            "notificationHubsNamespacesNotificationHubs": "ntf-",
            "operationalInsightsWorkspaces": "log-",
            "portalDashboards": "dash-",
            "powerBIDedicatedCapacities": "pbi-",
            "purviewAccounts": "pview-",
            "recoveryServicesVaults": "rsv-",
            "resourcesResourceGroups": "rg-",
            "searchSearchServices": "srch-",
            "serviceBusNamespaces": "sb-",
            "serviceBusNamespacesQueues": "sbq-",
            "serviceBusNamespacesTopics": "sbt-",
            "serviceEndPointPolicies": "se-",
            "serviceFabricClusters": "sf-",
            "signalRServiceSignalR": "sigr",
            "sqlManagedInstances": "sqlmi-",
            "sqlServers": "sql-",
            "sqlServersDataWarehouse": "sqldw-",
            "sqlServersDatabases": "sqldb-",
            "sqlServersDatabasesStretch": "sqlstrdb-",
            "storageStorageAccounts": "st",
            "storageStorageAccountsVm": "stvm",
            "storSimpleManagers": "ssimp",
            "streamAnalyticsCluster": "asa-",
            "synapseWorkspaces": "syn",
            "synapseWorkspacesAnalyticsWorkspaces": "synw",
            "synapseWorkspacesSqlPoolsDedicated": "syndp",
            "synapseWorkspacesSqlPoolsSpark": "synsp",
            "timeSeriesInsightsEnvironments": "tsi-",
            "webServerFarms": "plan-",
            "webSitesAppService": "app-",
            "webSitesAppServiceEnvironment": "ase-",
            "webSitesFunctions": "func-",
            "webStaticSites": "stapp-"
        },
        "tags": {
            "azd-env-name": "[parameters('environmentName')]"
        },
        "abbrs": "[variables('$fxv#0')]",
        "resourceToken": "[toLower(uniqueString(subscription().id, parameters('environmentName'), parameters('location')))]"
    },
    "resources": [
        {
            "type": "Microsoft.Resources/resourceGroups",
            "apiVersion": "2022-09-01",
            "name": "[format('rg-{0}', parameters('environmentName'))]",
            "location": "[parameters('location')]",
            "tags": "[variables('tags')]"
        },
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2022-09-01",
            "name": "monitoring",
            "dependsOn": [
                "[subscriptionResourceId('Microsoft.Resources/resourceGroups', format('rg-{0}', parameters('environmentName')))]"
            ],
            "properties": {
                "expressionEvaluationOptions": {
                    "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                    "location": {
                        "value": "[parameters('location')]"
                    },
                    "tags": {
                        "value": "[variables('tags')]"
                    },
                    "logAnalyticsName": {
                        "value": "[format('{0}{1}', variables('abbrs').operationalInsightsWorkspaces, variables('resourceToken'))]"
                    },
                    "applicationInsightsName": {
                        "value": "[format('{0}{1}', variables('abbrs').insightsComponents, variables('resourceToken'))]"
                    }
                },
                "template": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "metadata": {
                        "_generator": {
                            "name": "bicep",
                            "version": "0.28.1.47646",
                            "templateHash": "17205905062489807863"
                        }
                    },
                    "parameters": {
                        "logAnalyticsName": {
                            "type": "string"
                        },
                        "applicationInsightsName": {
                            "type": "string"
                        },
                        "location": {
                            "type": "string",
                            "defaultValue": "[resourceGroup().location]"
                        },
                        "tags": {
                            "type": "object",
                            "defaultValue": {}
                        }
                    },
                    "resources": [
                        {
                            "type": "Microsoft.OperationalInsights/workspaces",
                            "apiVersion": "2021-12-01-preview",
                            "name": "[parameters('logAnalyticsName')]",
                            "location": "[parameters('location')]",
                            "tags": "[parameters('tags')]",
                            "properties": {
                                "retentionInDays": 30,
                                "features": {
                                    "searchVersion": 1
                                },
                                "sku": {
                                    "name": "PerGB2018"
                                }
                            }
                        },
                        {
                            "type": "Microsoft.Insights/components",
                            "apiVersion": "2020-02-02",
                            "name": "[parameters('applicationInsightsName')]",
                            "location": "[parameters('location')]",
                            "tags": "[parameters('tags')]",
                            "kind": "web",
                            "properties": {
                                "Application_Type": "web",
                                "WorkspaceResourceId": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('logAnalyticsName'))]"
                            },
                            "dependsOn": [
                                "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('logAnalyticsName'))]"
                            ]
                        }
                    ],
                    "outputs": {
                        "applicationInsightsName": {
                            "type": "string",
                            "value": "[parameters('applicationInsightsName')]"
                        },
                        "logAnalyticsWorkspaceId": {
                            "type": "string",
                            "value": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('logAnalyticsName'))]"
                        },
                        "logAnalyticsWorkspaceName": {
                            "type": "string",
                            "value": "[parameters('logAnalyticsName')]"
                        }
                    }
                }
            },
            "resourceGroup": "[format('rg-{0}', parameters('environmentName'))]"
        },
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2022-09-01",
            "name": "dashboard",
            "dependsOn": [
                "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, format('rg-{0}', parameters('environmentName'))), 'Microsoft.Resources/deployments', 'monitoring')]",
                "[subscriptionResourceId('Microsoft.Resources/resourceGroups', format('rg-{0}', parameters('environmentName')))]"
            ],
            "properties": {
                "expressionEvaluationOptions": {
                    "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                    "name": {
                        "value": "[format('{0}{1}', variables('abbrs').portalDashboards, variables('resourceToken'))]"
                    },
                    "applicationInsightsName": {
                        "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, format('rg-{0}', parameters('environmentName'))), 'Microsoft.Resources/deployments', 'monitoring'), '2022-09-01').outputs.applicationInsightsName.value]"
                    },
                    "location": {
                        "value": "[parameters('location')]"
                    },
                    "tags": {
                        "value": "[variables('tags')]"
                    }
                },
                "template": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "metadata": {
                        "_generator": {
                            "name": "bicep",
                            "version": "0.28.1.47646",
                            "templateHash": "16888843495579376877"
                        }
                    },
                    "parameters": {
                        "name": {
                            "type": "string"
                        },
                        "applicationInsightsName": {
                            "type": "string"
                        },
                        "location": {
                            "type": "string",
                            "defaultValue": "[resourceGroup().location]"
                        },
                        "tags": {
                            "type": "object",
                            "defaultValue": {}
                        }
                    },
                    "resources": [
                        {
                            "type": "Microsoft.Portal/dashboards",
                            "apiVersion": "2020-09-01-preview",
                            "name": "[parameters('name')]",
                            "location": "[parameters('location')]",
                            "tags": "[parameters('tags')]",
                            "properties": {
                                "lenses": [
                                    {
                                        "order": 0,
                                        "parts": [
                                            {
                                                "position": {
                                                    "x": 0,
                                                    "y": 0,
                                                    "colSpan": 2,
                                                    "rowSpan": 1
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "id",
                                                            "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                        },
                                                        {
                                                            "name": "Version",
                                                            "value": "1.0"
                                                        }
                                                    ],
                                                    "type": "Extension/AppInsightsExtension/PartType/AspNetOverviewPinnedPart",
                                                    "asset": {
                                                        "idInputName": "id",
                                                        "type": "ApplicationInsights"
                                                    },
                                                    "defaultMenuItemId": "overview"
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 2,
                                                    "y": 0,
                                                    "colSpan": 1,
                                                    "rowSpan": 1
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "ComponentId",
                                                            "value": {
                                                                "Name": "[parameters('applicationInsightsName')]",
                                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                                "ResourceGroup": "[resourceGroup().name]"
                                                            }
                                                        },
                                                        {
                                                            "name": "Version",
                                                            "value": "1.0"
                                                        }
                                                    ],
                                                    "type": "Extension/AppInsightsExtension/PartType/ProactiveDetectionAsyncPart",
                                                    "asset": {
                                                        "idInputName": "ComponentId",
                                                        "type": "ApplicationInsights"
                                                    },
                                                    "defaultMenuItemId": "ProactiveDetection"
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 3,
                                                    "y": 0,
                                                    "colSpan": 1,
                                                    "rowSpan": 1
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "ComponentId",
                                                            "value": {
                                                                "Name": "[parameters('applicationInsightsName')]",
                                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                                "ResourceGroup": "[resourceGroup().name]"
                                                            }
                                                        },
                                                        {
                                                            "name": "ResourceId",
                                                            "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                        }
                                                    ],
                                                    "type": "Extension/AppInsightsExtension/PartType/QuickPulseButtonSmallPart",
                                                    "asset": {
                                                        "idInputName": "ComponentId",
                                                        "type": "ApplicationInsights"
                                                    }
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 4,
                                                    "y": 0,
                                                    "colSpan": 1,
                                                    "rowSpan": 1
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "ComponentId",
                                                            "value": {
                                                                "Name": "[parameters('applicationInsightsName')]",
                                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                                "ResourceGroup": "[resourceGroup().name]"
                                                            }
                                                        },
                                                        {
                                                            "name": "TimeContext",
                                                            "value": {
                                                                "durationMs": 86400000,
                                                                "endTime": null,
                                                                "createdTime": "2018-05-04T01:20:33.345Z",
                                                                "isInitialTime": true,
                                                                "grain": 1,
                                                                "useDashboardTimeRange": false
                                                            }
                                                        },
                                                        {
                                                            "name": "Version",
                                                            "value": "1.0"
                                                        }
                                                    ],
                                                    "type": "Extension/AppInsightsExtension/PartType/AvailabilityNavButtonPart",
                                                    "asset": {
                                                        "idInputName": "ComponentId",
                                                        "type": "ApplicationInsights"
                                                    }
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 5,
                                                    "y": 0,
                                                    "colSpan": 1,
                                                    "rowSpan": 1
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "ComponentId",
                                                            "value": {
                                                                "Name": "[parameters('applicationInsightsName')]",
                                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                                "ResourceGroup": "[resourceGroup().name]"
                                                            }
                                                        },
                                                        {
                                                            "name": "TimeContext",
                                                            "value": {
                                                                "durationMs": 86400000,
                                                                "endTime": null,
                                                                "createdTime": "2018-05-08T18:47:35.237Z",
                                                                "isInitialTime": true,
                                                                "grain": 1,
                                                                "useDashboardTimeRange": false
                                                            }
                                                        },
                                                        {
                                                            "name": "ConfigurationId",
                                                            "value": "78ce933e-e864-4b05-a27b-71fd55a6afad"
                                                        }
                                                    ],
                                                    "type": "Extension/AppInsightsExtension/PartType/AppMapButtonPart",
                                                    "asset": {
                                                        "idInputName": "ComponentId",
                                                        "type": "ApplicationInsights"
                                                    }
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 0,
                                                    "y": 1,
                                                    "colSpan": 3,
                                                    "rowSpan": 1
                                                },
                                                "metadata": {
                                                    "inputs": [],
                                                    "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                                    "settings": {
                                                        "content": {
                                                            "settings": {
                                                                "content": "# Usage",
                                                                "title": "",
                                                                "subtitle": ""
                                                            }
                                                        }
                                                    }
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 3,
                                                    "y": 1,
                                                    "colSpan": 1,
                                                    "rowSpan": 1
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "ComponentId",
                                                            "value": {
                                                                "Name": "[parameters('applicationInsightsName')]",
                                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                                "ResourceGroup": "[resourceGroup().name]"
                                                            }
                                                        },
                                                        {
                                                            "name": "TimeContext",
                                                            "value": {
                                                                "durationMs": 86400000,
                                                                "endTime": null,
                                                                "createdTime": "2018-05-04T01:22:35.782Z",
                                                                "isInitialTime": true,
                                                                "grain": 1,
                                                                "useDashboardTimeRange": false
                                                            }
                                                        }
                                                    ],
                                                    "type": "Extension/AppInsightsExtension/PartType/UsageUsersOverviewPart",
                                                    "asset": {
                                                        "idInputName": "ComponentId",
                                                        "type": "ApplicationInsights"
                                                    }
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 4,
                                                    "y": 1,
                                                    "colSpan": 3,
                                                    "rowSpan": 1
                                                },
                                                "metadata": {
                                                    "inputs": [],
                                                    "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                                    "settings": {
                                                        "content": {
                                                            "settings": {
                                                                "content": "# Reliability",
                                                                "title": "",
                                                                "subtitle": ""
                                                            }
                                                        }
                                                    }
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 7,
                                                    "y": 1,
                                                    "colSpan": 1,
                                                    "rowSpan": 1
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "ResourceId",
                                                            "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                        },
                                                        {
                                                            "name": "DataModel",
                                                            "value": {
                                                                "version": "1.0.0",
                                                                "timeContext": {
                                                                    "durationMs": 86400000,
                                                                    "createdTime": "2018-05-04T23:42:40.072Z",
                                                                    "isInitialTime": false,
                                                                    "grain": 1,
                                                                    "useDashboardTimeRange": false
                                                                }
                                                            },
                                                            "isOptional": true
                                                        },
                                                        {
                                                            "name": "ConfigurationId",
                                                            "value": "8a02f7bf-ac0f-40e1-afe9-f0e72cfee77f",
                                                            "isOptional": true
                                                        }
                                                    ],
                                                    "type": "Extension/AppInsightsExtension/PartType/CuratedBladeFailuresPinnedPart",
                                                    "isAdapter": true,
                                                    "asset": {
                                                        "idInputName": "ResourceId",
                                                        "type": "ApplicationInsights"
                                                    },
                                                    "defaultMenuItemId": "failures"
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 8,
                                                    "y": 1,
                                                    "colSpan": 3,
                                                    "rowSpan": 1
                                                },
                                                "metadata": {
                                                    "inputs": [],
                                                    "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                                    "settings": {
                                                        "content": {
                                                            "settings": {
                                                                "content": "# Responsiveness\r\n",
                                                                "title": "",
                                                                "subtitle": ""
                                                            }
                                                        }
                                                    }
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 11,
                                                    "y": 1,
                                                    "colSpan": 1,
                                                    "rowSpan": 1
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "ResourceId",
                                                            "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                        },
                                                        {
                                                            "name": "DataModel",
                                                            "value": {
                                                                "version": "1.0.0",
                                                                "timeContext": {
                                                                    "durationMs": 86400000,
                                                                    "createdTime": "2018-05-04T23:43:37.804Z",
                                                                    "isInitialTime": false,
                                                                    "grain": 1,
                                                                    "useDashboardTimeRange": false
                                                                }
                                                            },
                                                            "isOptional": true
                                                        },
                                                        {
                                                            "name": "ConfigurationId",
                                                            "value": "2a8ede4f-2bee-4b9c-aed9-2db0e8a01865",
                                                            "isOptional": true
                                                        }
                                                    ],
                                                    "type": "Extension/AppInsightsExtension/PartType/CuratedBladePerformancePinnedPart",
                                                    "isAdapter": true,
                                                    "asset": {
                                                        "idInputName": "ResourceId",
                                                        "type": "ApplicationInsights"
                                                    },
                                                    "defaultMenuItemId": "performance"
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 12,
                                                    "y": 1,
                                                    "colSpan": 3,
                                                    "rowSpan": 1
                                                },
                                                "metadata": {
                                                    "inputs": [],
                                                    "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                                    "settings": {
                                                        "content": {
                                                            "settings": {
                                                                "content": "# Browser",
                                                                "title": "",
                                                                "subtitle": ""
                                                            }
                                                        }
                                                    }
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 15,
                                                    "y": 1,
                                                    "colSpan": 1,
                                                    "rowSpan": 1
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "ComponentId",
                                                            "value": {
                                                                "Name": "[parameters('applicationInsightsName')]",
                                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                                "ResourceGroup": "[resourceGroup().name]"
                                                            }
                                                        },
                                                        {
                                                            "name": "MetricsExplorerJsonDefinitionId",
                                                            "value": "BrowserPerformanceTimelineMetrics"
                                                        },
                                                        {
                                                            "name": "TimeContext",
                                                            "value": {
                                                                "durationMs": 86400000,
                                                                "createdTime": "2018-05-08T12:16:27.534Z",
                                                                "isInitialTime": false,
                                                                "grain": 1,
                                                                "useDashboardTimeRange": false
                                                            }
                                                        },
                                                        {
                                                            "name": "CurrentFilter",
                                                            "value": {
                                                                "eventTypes": [
                                                                    4,
                                                                    1,
                                                                    3,
                                                                    5,
                                                                    2,
                                                                    6,
                                                                    13
                                                                ],
                                                                "typeFacets": {},
                                                                "isPermissive": false
                                                            }
                                                        },
                                                        {
                                                            "name": "id",
                                                            "value": {
                                                                "Name": "[parameters('applicationInsightsName')]",
                                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                                "ResourceGroup": "[resourceGroup().name]"
                                                            }
                                                        },
                                                        {
                                                            "name": "Version",
                                                            "value": "1.0"
                                                        }
                                                    ],
                                                    "type": "Extension/AppInsightsExtension/PartType/MetricsExplorerBladePinnedPart",
                                                    "asset": {
                                                        "idInputName": "ComponentId",
                                                        "type": "ApplicationInsights"
                                                    },
                                                    "defaultMenuItemId": "browser"
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 0,
                                                    "y": 2,
                                                    "colSpan": 4,
                                                    "rowSpan": 3
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "options",
                                                            "value": {
                                                                "chart": {
                                                                    "metrics": [
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "sessions/count",
                                                                            "aggregationType": 5,
                                                                            "namespace": "microsoft.insights/components/kusto",
                                                                            "metricVisualization": {
                                                                                "displayName": "Sessions",
                                                                                "color": "#47BDF5"
                                                                            }
                                                                        },
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "users/count",
                                                                            "aggregationType": 5,
                                                                            "namespace": "microsoft.insights/components/kusto",
                                                                            "metricVisualization": {
                                                                                "displayName": "Users",
                                                                                "color": "#7E58FF"
                                                                            }
                                                                        }
                                                                    ],
                                                                    "title": "Unique sessions and users",
                                                                    "visualization": {
                                                                        "chartType": 2,
                                                                        "legendVisualization": {
                                                                            "isVisible": true,
                                                                            "position": 2,
                                                                            "hideSubtitle": false
                                                                        },
                                                                        "axisVisualization": {
                                                                            "x": {
                                                                                "isVisible": true,
                                                                                "axisType": 2
                                                                            },
                                                                            "y": {
                                                                                "isVisible": true,
                                                                                "axisType": 1
                                                                            }
                                                                        }
                                                                    },
                                                                    "openBladeOnClick": {
                                                                        "openBlade": true,
                                                                        "destinationBlade": {
                                                                            "extensionName": "HubsExtension",
                                                                            "bladeName": "ResourceMenuBlade",
                                                                            "parameters": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                                                "menuid": "segmentationUsers"
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "name": "sharedTimeRange",
                                                            "isOptional": true
                                                        }
                                                    ],
                                                    "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                                    "settings": {}
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 4,
                                                    "y": 2,
                                                    "colSpan": 4,
                                                    "rowSpan": 3
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "options",
                                                            "value": {
                                                                "chart": {
                                                                    "metrics": [
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "requests/failed",
                                                                            "aggregationType": 7,
                                                                            "namespace": "microsoft.insights/components",
                                                                            "metricVisualization": {
                                                                                "displayName": "Failed requests",
                                                                                "color": "#EC008C"
                                                                            }
                                                                        }
                                                                    ],
                                                                    "title": "Failed requests",
                                                                    "visualization": {
                                                                        "chartType": 3,
                                                                        "legendVisualization": {
                                                                            "isVisible": true,
                                                                            "position": 2,
                                                                            "hideSubtitle": false
                                                                        },
                                                                        "axisVisualization": {
                                                                            "x": {
                                                                                "isVisible": true,
                                                                                "axisType": 2
                                                                            },
                                                                            "y": {
                                                                                "isVisible": true,
                                                                                "axisType": 1
                                                                            }
                                                                        }
                                                                    },
                                                                    "openBladeOnClick": {
                                                                        "openBlade": true,
                                                                        "destinationBlade": {
                                                                            "extensionName": "HubsExtension",
                                                                            "bladeName": "ResourceMenuBlade",
                                                                            "parameters": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                                                "menuid": "failures"
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "name": "sharedTimeRange",
                                                            "isOptional": true
                                                        }
                                                    ],
                                                    "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                                    "settings": {}
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 8,
                                                    "y": 2,
                                                    "colSpan": 4,
                                                    "rowSpan": 3
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "options",
                                                            "value": {
                                                                "chart": {
                                                                    "metrics": [
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "requests/duration",
                                                                            "aggregationType": 4,
                                                                            "namespace": "microsoft.insights/components",
                                                                            "metricVisualization": {
                                                                                "displayName": "Server response time",
                                                                                "color": "#00BCF2"
                                                                            }
                                                                        }
                                                                    ],
                                                                    "title": "Server response time",
                                                                    "visualization": {
                                                                        "chartType": 2,
                                                                        "legendVisualization": {
                                                                            "isVisible": true,
                                                                            "position": 2,
                                                                            "hideSubtitle": false
                                                                        },
                                                                        "axisVisualization": {
                                                                            "x": {
                                                                                "isVisible": true,
                                                                                "axisType": 2
                                                                            },
                                                                            "y": {
                                                                                "isVisible": true,
                                                                                "axisType": 1
                                                                            }
                                                                        }
                                                                    },
                                                                    "openBladeOnClick": {
                                                                        "openBlade": true,
                                                                        "destinationBlade": {
                                                                            "extensionName": "HubsExtension",
                                                                            "bladeName": "ResourceMenuBlade",
                                                                            "parameters": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                                                "menuid": "performance"
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "name": "sharedTimeRange",
                                                            "isOptional": true
                                                        }
                                                    ],
                                                    "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                                    "settings": {}
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 12,
                                                    "y": 2,
                                                    "colSpan": 4,
                                                    "rowSpan": 3
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "options",
                                                            "value": {
                                                                "chart": {
                                                                    "metrics": [
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "browserTimings/networkDuration",
                                                                            "aggregationType": 4,
                                                                            "namespace": "microsoft.insights/components",
                                                                            "metricVisualization": {
                                                                                "displayName": "Page load network connect time",
                                                                                "color": "#7E58FF"
                                                                            }
                                                                        },
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "browserTimings/processingDuration",
                                                                            "aggregationType": 4,
                                                                            "namespace": "microsoft.insights/components",
                                                                            "metricVisualization": {
                                                                                "displayName": "Client processing time",
                                                                                "color": "#44F1C8"
                                                                            }
                                                                        },
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "browserTimings/sendDuration",
                                                                            "aggregationType": 4,
                                                                            "namespace": "microsoft.insights/components",
                                                                            "metricVisualization": {
                                                                                "displayName": "Send request time",
                                                                                "color": "#EB9371"
                                                                            }
                                                                        },
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "browserTimings/receiveDuration",
                                                                            "aggregationType": 4,
                                                                            "namespace": "microsoft.insights/components",
                                                                            "metricVisualization": {
                                                                                "displayName": "Receiving response time",
                                                                                "color": "#0672F1"
                                                                            }
                                                                        }
                                                                    ],
                                                                    "title": "Average page load time breakdown",
                                                                    "visualization": {
                                                                        "chartType": 3,
                                                                        "legendVisualization": {
                                                                            "isVisible": true,
                                                                            "position": 2,
                                                                            "hideSubtitle": false
                                                                        },
                                                                        "axisVisualization": {
                                                                            "x": {
                                                                                "isVisible": true,
                                                                                "axisType": 2
                                                                            },
                                                                            "y": {
                                                                                "isVisible": true,
                                                                                "axisType": 1
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "name": "sharedTimeRange",
                                                            "isOptional": true
                                                        }
                                                    ],
                                                    "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                                    "settings": {}
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 0,
                                                    "y": 5,
                                                    "colSpan": 4,
                                                    "rowSpan": 3
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "options",
                                                            "value": {
                                                                "chart": {
                                                                    "metrics": [
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "availabilityResults/availabilityPercentage",
                                                                            "aggregationType": 4,
                                                                            "namespace": "microsoft.insights/components",
                                                                            "metricVisualization": {
                                                                                "displayName": "Availability",
                                                                                "color": "#47BDF5"
                                                                            }
                                                                        }
                                                                    ],
                                                                    "title": "Average availability",
                                                                    "visualization": {
                                                                        "chartType": 3,
                                                                        "legendVisualization": {
                                                                            "isVisible": true,
                                                                            "position": 2,
                                                                            "hideSubtitle": false
                                                                        },
                                                                        "axisVisualization": {
                                                                            "x": {
                                                                                "isVisible": true,
                                                                                "axisType": 2
                                                                            },
                                                                            "y": {
                                                                                "isVisible": true,
                                                                                "axisType": 1
                                                                            }
                                                                        }
                                                                    },
                                                                    "openBladeOnClick": {
                                                                        "openBlade": true,
                                                                        "destinationBlade": {
                                                                            "extensionName": "HubsExtension",
                                                                            "bladeName": "ResourceMenuBlade",
                                                                            "parameters": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                                                "menuid": "availability"
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "name": "sharedTimeRange",
                                                            "isOptional": true
                                                        }
                                                    ],
                                                    "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                                    "settings": {}
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 4,
                                                    "y": 5,
                                                    "colSpan": 4,
                                                    "rowSpan": 3
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "options",
                                                            "value": {
                                                                "chart": {
                                                                    "metrics": [
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "exceptions/server",
                                                                            "aggregationType": 7,
                                                                            "namespace": "microsoft.insights/components",
                                                                            "metricVisualization": {
                                                                                "displayName": "Server exceptions",
                                                                                "color": "#47BDF5"
                                                                            }
                                                                        },
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "dependencies/failed",
                                                                            "aggregationType": 7,
                                                                            "namespace": "microsoft.insights/components",
                                                                            "metricVisualization": {
                                                                                "displayName": "Dependency failures",
                                                                                "color": "#7E58FF"
                                                                            }
                                                                        }
                                                                    ],
                                                                    "title": "Server exceptions and Dependency failures",
                                                                    "visualization": {
                                                                        "chartType": 2,
                                                                        "legendVisualization": {
                                                                            "isVisible": true,
                                                                            "position": 2,
                                                                            "hideSubtitle": false
                                                                        },
                                                                        "axisVisualization": {
                                                                            "x": {
                                                                                "isVisible": true,
                                                                                "axisType": 2
                                                                            },
                                                                            "y": {
                                                                                "isVisible": true,
                                                                                "axisType": 1
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "name": "sharedTimeRange",
                                                            "isOptional": true
                                                        }
                                                    ],
                                                    "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                                    "settings": {}
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 8,
                                                    "y": 5,
                                                    "colSpan": 4,
                                                    "rowSpan": 3
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "options",
                                                            "value": {
                                                                "chart": {
                                                                    "metrics": [
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "performanceCounters/processorCpuPercentage",
                                                                            "aggregationType": 4,
                                                                            "namespace": "microsoft.insights/components",
                                                                            "metricVisualization": {
                                                                                "displayName": "Processor time",
                                                                                "color": "#47BDF5"
                                                                            }
                                                                        },
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "performanceCounters/processCpuPercentage",
                                                                            "aggregationType": 4,
                                                                            "namespace": "microsoft.insights/components",
                                                                            "metricVisualization": {
                                                                                "displayName": "Process CPU",
                                                                                "color": "#7E58FF"
                                                                            }
                                                                        }
                                                                    ],
                                                                    "title": "Average processor and process CPU utilization",
                                                                    "visualization": {
                                                                        "chartType": 2,
                                                                        "legendVisualization": {
                                                                            "isVisible": true,
                                                                            "position": 2,
                                                                            "hideSubtitle": false
                                                                        },
                                                                        "axisVisualization": {
                                                                            "x": {
                                                                                "isVisible": true,
                                                                                "axisType": 2
                                                                            },
                                                                            "y": {
                                                                                "isVisible": true,
                                                                                "axisType": 1
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "name": "sharedTimeRange",
                                                            "isOptional": true
                                                        }
                                                    ],
                                                    "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                                    "settings": {}
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 12,
                                                    "y": 5,
                                                    "colSpan": 4,
                                                    "rowSpan": 3
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "options",
                                                            "value": {
                                                                "chart": {
                                                                    "metrics": [
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "exceptions/browser",
                                                                            "aggregationType": 7,
                                                                            "namespace": "microsoft.insights/components",
                                                                            "metricVisualization": {
                                                                                "displayName": "Browser exceptions",
                                                                                "color": "#47BDF5"
                                                                            }
                                                                        }
                                                                    ],
                                                                    "title": "Browser exceptions",
                                                                    "visualization": {
                                                                        "chartType": 2,
                                                                        "legendVisualization": {
                                                                            "isVisible": true,
                                                                            "position": 2,
                                                                            "hideSubtitle": false
                                                                        },
                                                                        "axisVisualization": {
                                                                            "x": {
                                                                                "isVisible": true,
                                                                                "axisType": 2
                                                                            },
                                                                            "y": {
                                                                                "isVisible": true,
                                                                                "axisType": 1
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "name": "sharedTimeRange",
                                                            "isOptional": true
                                                        }
                                                    ],
                                                    "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                                    "settings": {}
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 0,
                                                    "y": 8,
                                                    "colSpan": 4,
                                                    "rowSpan": 3
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "options",
                                                            "value": {
                                                                "chart": {
                                                                    "metrics": [
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "availabilityResults/count",
                                                                            "aggregationType": 7,
                                                                            "namespace": "microsoft.insights/components",
                                                                            "metricVisualization": {
                                                                                "displayName": "Availability test results count",
                                                                                "color": "#47BDF5"
                                                                            }
                                                                        }
                                                                    ],
                                                                    "title": "Availability test results count",
                                                                    "visualization": {
                                                                        "chartType": 2,
                                                                        "legendVisualization": {
                                                                            "isVisible": true,
                                                                            "position": 2,
                                                                            "hideSubtitle": false
                                                                        },
                                                                        "axisVisualization": {
                                                                            "x": {
                                                                                "isVisible": true,
                                                                                "axisType": 2
                                                                            },
                                                                            "y": {
                                                                                "isVisible": true,
                                                                                "axisType": 1
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "name": "sharedTimeRange",
                                                            "isOptional": true
                                                        }
                                                    ],
                                                    "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                                    "settings": {}
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 4,
                                                    "y": 8,
                                                    "colSpan": 4,
                                                    "rowSpan": 3
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "options",
                                                            "value": {
                                                                "chart": {
                                                                    "metrics": [
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "performanceCounters/processIOBytesPerSecond",
                                                                            "aggregationType": 4,
                                                                            "namespace": "microsoft.insights/components",
                                                                            "metricVisualization": {
                                                                                "displayName": "Process IO rate",
                                                                                "color": "#47BDF5"
                                                                            }
                                                                        }
                                                                    ],
                                                                    "title": "Average process I/O rate",
                                                                    "visualization": {
                                                                        "chartType": 2,
                                                                        "legendVisualization": {
                                                                            "isVisible": true,
                                                                            "position": 2,
                                                                            "hideSubtitle": false
                                                                        },
                                                                        "axisVisualization": {
                                                                            "x": {
                                                                                "isVisible": true,
                                                                                "axisType": 2
                                                                            },
                                                                            "y": {
                                                                                "isVisible": true,
                                                                                "axisType": 1
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "name": "sharedTimeRange",
                                                            "isOptional": true
                                                        }
                                                    ],
                                                    "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                                    "settings": {}
                                                }
                                            },
                                            {
                                                "position": {
                                                    "x": 8,
                                                    "y": 8,
                                                    "colSpan": 4,
                                                    "rowSpan": 3
                                                },
                                                "metadata": {
                                                    "inputs": [
                                                        {
                                                            "name": "options",
                                                            "value": {
                                                                "chart": {
                                                                    "metrics": [
                                                                        {
                                                                            "resourceMetadata": {
                                                                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                                            },
                                                                            "name": "performanceCounters/memoryAvailableBytes",
                                                                            "aggregationType": 4,
                                                                            "namespace": "microsoft.insights/components",
                                                                            "metricVisualization": {
                                                                                "displayName": "Available memory",
                                                                                "color": "#47BDF5"
                                                                            }
                                                                        }
                                                                    ],
                                                                    "title": "Average available memory",
                                                                    "visualization": {
                                                                        "chartType": 2,
                                                                        "legendVisualization": {
                                                                            "isVisible": true,
                                                                            "position": 2,
                                                                            "hideSubtitle": false
                                                                        },
                                                                        "axisVisualization": {
                                                                            "x": {
                                                                                "isVisible": true,
                                                                                "axisType": 2
                                                                            },
                                                                            "y": {
                                                                                "isVisible": true,
                                                                                "axisType": 1
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "name": "sharedTimeRange",
                                                            "isOptional": true
                                                        }
                                                    ],
                                                    "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                                    "settings": {}
                                                }
                                            }
                                        ]
                                    }
                                ]
                            }
                        }
                    ]
                }
            },
            "resourceGroup": "[format('rg-{0}', parameters('environmentName'))]"
        },
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2022-09-01",
            "name": "registry",
            "dependsOn": [
                "[subscriptionResourceId('Microsoft.Resources/resourceGroups', format('rg-{0}', parameters('environmentName')))]"
            ],
            "properties": {
                "expressionEvaluationOptions": {
                    "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                    "location": {
                        "value": "[parameters('location')]"
                    },
                    "tags": {
                        "value": "[variables('tags')]"
                    },
                    "name": {
                        "value": "[format('{0}{1}', variables('abbrs').containerRegistryRegistries, variables('resourceToken'))]"
                    }
                },
                "template": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "metadata": {
                        "_generator": {
                            "name": "bicep",
                            "version": "0.28.1.47646",
                            "templateHash": "8665097581667675958"
                        }
                    },
                    "parameters": {
                        "name": {
                            "type": "string"
                        },
                        "location": {
                            "type": "string",
                            "defaultValue": "[resourceGroup().location]"
                        },
                        "tags": {
                            "type": "object",
                            "defaultValue": {}
                        },
                        "adminUserEnabled": {
                            "type": "bool",
                            "defaultValue": true
                        },
                        "anonymousPullEnabled": {
                            "type": "bool",
                            "defaultValue": false
                        },
                        "dataEndpointEnabled": {
                            "type": "bool",
                            "defaultValue": false
                        },
                        "encryption": {
                            "type": "object",
                            "defaultValue": {
                                "status": "disabled"
                            }
                        },
                        "networkRuleBypassOptions": {
                            "type": "string",
                            "defaultValue": "AzureServices"
                        },
                        "publicNetworkAccess": {
                            "type": "string",
                            "defaultValue": "Enabled"
                        },
                        "sku": {
                            "type": "object",
                            "defaultValue": {
                                "name": "Standard"
                            }
                        },
                        "zoneRedundancy": {
                            "type": "string",
                            "defaultValue": "Disabled"
                        }
                    },
                    "resources": [
                        {
                            "type": "Microsoft.ContainerRegistry/registries",
                            "apiVersion": "2023-01-01-preview",
                            "name": "[parameters('name')]",
                            "location": "[parameters('location')]",
                            "tags": "[parameters('tags')]",
                            "sku": "[parameters('sku')]",
                            "properties": {
                                "adminUserEnabled": "[parameters('adminUserEnabled')]",
                                "anonymousPullEnabled": "[parameters('anonymousPullEnabled')]",
                                "dataEndpointEnabled": "[parameters('dataEndpointEnabled')]",
                                "encryption": "[parameters('encryption')]",
                                "networkRuleBypassOptions": "[parameters('networkRuleBypassOptions')]",
                                "publicNetworkAccess": "[parameters('publicNetworkAccess')]",
                                "zoneRedundancy": "[parameters('zoneRedundancy')]"
                            }
                        }
                    ],
                    "outputs": {
                        "loginServer": {
                            "type": "string",
                            "value": "[reference(resourceId('Microsoft.ContainerRegistry/registries', parameters('name')), '2023-01-01-preview').loginServer]"
                        },
                        "name": {
                            "type": "string",
                            "value": "[parameters('name')]"
                        }
                    }
                }
            },
            "resourceGroup": "[format('rg-{0}', parameters('environmentName'))]"
        },
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2022-09-01",
            "name": "keyvault",
            "dependsOn": [
                "[subscriptionResourceId('Microsoft.Resources/resourceGroups', format('rg-{0}', parameters('environmentName')))]"
            ],
            "properties": {
                "expressionEvaluationOptions": {
                    "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                    "location": {
                        "value": "[parameters('location')]"
                    },
                    "tags": {
                        "value": "[variables('tags')]"
                    },
                    "name": {
                        "value": "[format('{0}{1}', variables('abbrs').keyVaultVaults, variables('resourceToken'))]"
                    },
                    "principalId": {
                        "value": "[parameters('principalId')]"
                    }
                },
                "template": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "metadata": {
                        "_generator": {
                            "name": "bicep",
                            "version": "0.28.1.47646",
                            "templateHash": "9702307862467885620"
                        }
                    },
                    "parameters": {
                        "name": {
                            "type": "string"
                        },
                        "location": {
                            "type": "string",
                            "defaultValue": "[resourceGroup().location]"
                        },
                        "tags": {
                            "type": "object",
                            "defaultValue": {}
                        },
                        "principalId": {
                            "type": "string",
                            "defaultValue": "",
                            "metadata": {
                                "description": "Service principal that should be granted read access to the KeyVault. If unset, no service principal is granted access by default"
                            }
                        }
                    },
                    "variables": {
                        "defaultAccessPolicies": "[if(not(empty(parameters('principalId'))), createArray(createObject('objectId', parameters('principalId'), 'permissions', createObject('secrets', createArray('get', 'list')), 'tenantId', subscription().tenantId)), createArray())]"
                    },
                    "resources": [
                        {
                            "type": "Microsoft.KeyVault/vaults",
                            "apiVersion": "2022-07-01",
                            "name": "[parameters('name')]",
                            "location": "[parameters('location')]",
                            "tags": "[parameters('tags')]",
                            "properties": {
                                "tenantId": "[subscription().tenantId]",
                                "sku": {
                                    "family": "A",
                                    "name": "standard"
                                },
                                "enabledForTemplateDeployment": true,
                                "accessPolicies": "[union(variables('defaultAccessPolicies'), createArray())]"
                            }
                        }
                    ],
                    "outputs": {
                        "endpoint": {
                            "type": "string",
                            "value": "[reference(resourceId('Microsoft.KeyVault/vaults', parameters('name')), '2022-07-01').vaultUri]"
                        },
                        "name": {
                            "type": "string",
                            "value": "[parameters('name')]"
                        }
                    }
                }
            },
            "resourceGroup": "[format('rg-{0}', parameters('environmentName'))]"
        },
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2022-09-01",
            "name": "apps-env",
            "dependsOn": [
                "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, format('rg-{0}', parameters('environmentName'))), 'Microsoft.Resources/deployments', 'monitoring')]",
                "[subscriptionResourceId('Microsoft.Resources/resourceGroups', format('rg-{0}', parameters('environmentName')))]"
            ],
            "properties": {
                "expressionEvaluationOptions": {
                    "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                    "name": {
                        "value": "[format('{0}{1}', variables('abbrs').appManagedEnvironments, variables('resourceToken'))]"
                    },
                    "location": {
                        "value": "[parameters('location')]"
                    },
                    "tags": {
                        "value": "[variables('tags')]"
                    },
                    "applicationInsightsName": {
                        "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, format('rg-{0}', parameters('environmentName'))), 'Microsoft.Resources/deployments', 'monitoring'), '2022-09-01').outputs.applicationInsightsName.value]"
                    },
                    "logAnalyticsWorkspaceName": {
                        "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, format('rg-{0}', parameters('environmentName'))), 'Microsoft.Resources/deployments', 'monitoring'), '2022-09-01').outputs.logAnalyticsWorkspaceName.value]"
                    }
                },
                "template": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "metadata": {
                        "_generator": {
                            "name": "bicep",
                            "version": "0.28.1.47646",
                            "templateHash": "14750821921827513304"
                        }
                    },
                    "parameters": {
                        "name": {
                            "type": "string"
                        },
                        "location": {
                            "type": "string",
                            "defaultValue": "[resourceGroup().location]"
                        },
                        "tags": {
                            "type": "object",
                            "defaultValue": {}
                        },
                        "logAnalyticsWorkspaceName": {
                            "type": "string"
                        },
                        "applicationInsightsName": {
                            "type": "string",
                            "defaultValue": ""
                        }
                    },
                    "resources": [
                        {
                            "type": "Microsoft.App/managedEnvironments",
                            "apiVersion": "2022-10-01",
                            "name": "[parameters('name')]",
                            "location": "[parameters('location')]",
                            "tags": "[parameters('tags')]",
                            "properties": {
                                "appLogsConfiguration": {
                                    "destination": "log-analytics",
                                    "logAnalyticsConfiguration": {
                                        "customerId": "[reference(resourceId('Microsoft.OperationalInsights/workspaces', parameters('logAnalyticsWorkspaceName')), '2022-10-01').customerId]",
                                        "sharedKey": "[listKeys(resourceId('Microsoft.OperationalInsights/workspaces', parameters('logAnalyticsWorkspaceName')), '2022-10-01').primarySharedKey]"
                                    }
                                },
                                "daprAIConnectionString": "[reference(resourceId('Microsoft.Insights/components', parameters('applicationInsightsName')), '2020-02-02').ConnectionString]"
                            }
                        }
                    ],
                    "outputs": {
                        "name": {
                            "type": "string",
                            "value": "[parameters('name')]"
                        },
                        "domain": {
                            "type": "string",
                            "value": "[reference(resourceId('Microsoft.App/managedEnvironments', parameters('name')), '2022-10-01').defaultDomain]"
                        }
                    }
                }
            },
            "resourceGroup": "[format('rg-{0}', parameters('environmentName'))]"
        }
    ],
    "outputs": {
        "AZURE_CONTAINER_REGISTRY_ENDPOINT": {
            "type": "String",
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, format('rg-{0}', parameters('environmentName'))), 'Microsoft.Resources/deployments', 'registry'), '2022-09-01').outputs.loginServer.value]"
        },
        "AZURE_KEY_VAULT_NAME": {
            "type": "String",
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, format('rg-{0}', parameters('environmentName'))), 'Microsoft.Resources/deployments', 'keyvault'), '2022-09-01').outputs.name.value]"
        },
        "AZURE_KEY_VAULT_ENDPOINT": {
            "type": "String",
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, format('rg-{0}', parameters('environmentName'))), 'Microsoft.Resources/deployments', 'keyvault'), '2022-09-01').outputs.endpoint.value]"
        }
    }
}